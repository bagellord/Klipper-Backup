#############################################################################################################
### CONFIGURATION GENERATED BY THE RATOS CONFIGURATOR
#############################################################################################################
[include RatOS.cfg]
[include filament_sensor.cfg]
[include user-macros.cfg]

[shaketune]
# result_folder: ~/printer_data/config/ShakeTune_results
#    The folder where the results will be stored. It will be created if it doesn't exist.
# number_of_results_to_keep: 3
#    The number of results to keep in the result_folder. The oldest results will
#    be automatically deleted after each runs.
# keep_raw_csv: False
#    If True, the raw CSV files will be kept in the result_folder alongside the
#    PNG graphs. If False, they will be deleted and only the graphs will be kept.
# show_macros_in_webui: True
#    Mainsail and Fluidd doesn't create buttons for "system" macros that are not in the
#    printer.cfg file. If you want to see the macros in the webui, set this to True.
# timeout: 300
#    The maximum time in seconds to let Shake&Tune process the CSV files and generate the graphs.

#############################################################################################################
### MACRO CONFIGURATION
### Configure the behavior of RatOS macros
### See: https://os.ratrig.com/docs/configuration/macros
#############################################################################################################
[gcode_macro RatOS]
variable_relative_extrusion: False
variable_preheat_extruder: True
variable_calibrate_bed_mesh: True
variable_nozzle_priming: "primeblob"
variable_start_print_park_in: "back"
variable_start_print_park_z_height: 50
variable_end_print_park_in: "back"
variable_pause_print_park_in: "back"
variable_macro_travel_speed: 600
variable_macro_travel_accel: 8000
variable_beacon_scan_compensation_enable: True          # Enables the beacon scan compensation

#############################################################################################################
### USER OVERRIDES & CUSTOM CONFIGURATION
### Anything custom you want to add, or RatOS configuration you want to override, do it here.
### This section is pre-populated with the most common settings you may want to change.
### See: https://os.ratrig.com/docs/configuration/includes-and-overrides
###
### It is recommended that you follow these steps to properly calibrate your printer:
### 0) Sanity check and PID Tuning: https://www.klipper3d.org/Config_checks.html
### 1) Z-offset calibration: run BEACON_RATOS_CALIBRATE to automatically calibrate your beacon for scan and contact.
###    IMPORTANT: Ensure the beacon is properly mounted and the nozzle and meltzone is clean by unloading
###    the filament (if it's loaded) and make sure there's no ooze or gunk on the nozzle when the hotend is at printing temperature.
### 2) Pressure Advance: https://www.klipper3d.org/Pressure_Advance.html
### 3) Skew Correction: https://www.klipper3d.org/Skew_Correction.html
### 4) Resonance Compensation: https://www.klipper3d.org/Resonance_Compensation.html
### RatOS has dedicated macro's to generate shaper graphs for deeper analysis (requires accelerometer).
### Use MEASURE_COREXY_BELT_TENSION to compare tension between belts, and use
### GENERATE_SHAPER_GRAPHS to generate the resonance graphs for analysing and manually entering input shaper
### configuration.
### You can run SHAPER_CALIBRATE to automatically calibrate your input shaper configuration, if you just want
### to get started.
### Additionally, you can use the Realtime Analysis Tool to analyze your printer's performance in real-time.
### Read more about klipper here: https://www.klipper3d.org/Overview.html
#############################################################################################################

#---------------------------------------------------- X -----------------------------------------------------
# The A motor in the CoreXY system, located at the rear left of the printer
#------------------------------------------------------------------------------------------------------------
[stepper_x]
dir_pin: x_dir_pin                # Add ! in front of pin name to reverse the direction of stepper_x
rotation_distance: 40             # 40 for 20 tooth 2GT pulleys, 32 for 16 tooth 2GT pulleys
homing_speed: 50
position_min: -60
position_max: 360
position_endstop: -60

#---------------------------------------------------- Y -----------------------------------------------------
# The B motor in the CoreXY system, located at the rear right of the printer
#------------------------------------------------------------------------------------------------------------
[stepper_y]
dir_pin: y_dir_pin                # Add ! in front of pin name to reverse the direction of stepper_y
rotation_distance: 40             # 40 for 20 tooth 2GT pulleys, 32 for 16 tooth 2GT pulleys
homing_speed: 50
position_min: -15
position_max: 330
position_endstop: -15

#---------------------------------------------------- Z -----------------------------------------------------
# The left Z motor for the kinematic bed
#------------------------------------------------------------------------------------------------------------
[stepper_z]
dir_pin: !z0_dir_pin              # Remove ! in front of pin name to reverse the direction of stepper_z
rotation_distance: 4              # 4 for TR8*4 lead screws
homing_speed: 10
position_min: -5
position_max: 300

#---------------------------------------------------- Z1 ----------------------------------------------------
# The rear Z motor for the kinematic bed
#------------------------------------------------------------------------------------------------------------
[stepper_z1]
dir_pin: !z1_dir_pin              # Remove ! in front of pin name to reverse the direction of stepper_z1
rotation_distance: 4              # 4 for TR8*4 lead screws

#---------------------------------------------------- Z2 ----------------------------------------------------
# The right Z motor for the kinematic bed
#------------------------------------------------------------------------------------------------------------
[stepper_z2]
dir_pin: !z2_dir_pin              # Remove ! in front of pin name to reverse the direction of stepper_z2
rotation_distance: 4              # 4 for TR8*4 lead screws

#------------------------------------------------- EXTRUDER -------------------------------------------------
# The extruder motor used for pushing filament through the toolhead
#------------------------------------------------------------------------------------------------------------
[extruder]
dir_pin: toolboard_t0:e_dir_pin   # Add ! in front of pin name to reverse the direction of extruder
rotation_distance: 4.63           # Orbiter 2 default
#pressure_advance: 0.05           # Check https://www.klipper3d.org/Pressure_Advance.html for pressure advance tuning.
control: pid
pid_kp: 28.413
pid_ki: 1.334
pid_kd: 151.300

[heater_bed]
control: pid
pid_Kp: 22.2
pid_Ki: 1.08
pid_Kd: 114

[led lightbars]
white_pin: PA2

[fan]
#pin: !toolboard_t0:PA0
pin: !PD15
enable_pin: PA3
cycle_time: 0.00004

[temperature_sensor chamber]
sensor_type: Generic 3950
sensor_pin: PF4
min_temp: 0
max_temp: 100
gcode_id: C

# REMEMBER TO CALIBRATE YOUR BEACON!
# Run BEACON_RATOS_CALIBRATE for automatic calibration.

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [beacon model default]
#*# model_coef = 1.4643943640729287,
#*# 	  1.8109552029162734,
#*# 	  0.8161631598936686,
#*# 	  0.3642305155207256,
#*# 	  0.3423058399772304,
#*# 	  0.4836691819838708,
#*# 	  -0.16126325375862627,
#*# 	  -0.5281005855120587,
#*# 	  0.13892042903790916,
#*# 	  0.2721145498784482
#*# model_domain = 1.814303239021103e-07,1.926997981852523e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 36.564660
#*# model_offset = 0.05153
#*#
#*# [bed_mesh Contact]
#*# version = 1
#*# points =
#*# 	0.146250, 0.152344, 0.149687, 0.147969, 0.149531, 0.129062, 0.132344, 0.145937, 0.107812, 0.119375, 0.074219, 0.094531, 0.065156, 0.065625, 0.075312
#*# 	0.147656, 0.152031, 0.157500, 0.176719, 0.165781, 0.153437, 0.122187, 0.126562, 0.126250, 0.092187, 0.109844, 0.077031, 0.041719, 0.046406, 0.039375
#*# 	0.149687, 0.154375, 0.154531, 0.148750, 0.150781, 0.145937, 0.126719, 0.119687, 0.121406, 0.110312, 0.095469, 0.074219, 0.050156, 0.049844, 0.048281
#*# 	0.152500, 0.156406, 0.170781, 0.147187, 0.159844, 0.140156, 0.134844, 0.120625, 0.114844, 0.095625, 0.070781, 0.069375, 0.038125, 0.034375, 0.030469
#*# 	0.151562, 0.125937, 0.146094, 0.138594, 0.154219, 0.116719, 0.135156, 0.123750, 0.121250, 0.110000, 0.084062, 0.055312, 0.050937, 0.050000, 0.040000
#*# 	0.138281, 0.132344, 0.141250, 0.139844, 0.140312, 0.113594, 0.121719, 0.117187, 0.119844, 0.115312, 0.099375, 0.067812, 0.045156, 0.044375, 0.034687
#*# 	0.123750, 0.140312, 0.145625, 0.118906, 0.125000, 0.093594, 0.129062, 0.141406, 0.101562, 0.085000, 0.076719, 0.073750, 0.045312, 0.030625, 0.032500
#*# 	0.138750, 0.142812, 0.152656, 0.139687, 0.112969, 0.118437, 0.115156, 0.102031, 0.086719, 0.082500, 0.063281, 0.070781, 0.036250, 0.002187, -0.012031
#*# 	0.122969, 0.122031, 0.142187, 0.133125, 0.123437, 0.120781, 0.115312, 0.113594, 0.094531, 0.085625, 0.066250, 0.045156, 0.057969, 0.022812, -0.002656
#*# 	0.124062, 0.122812, 0.127187, 0.129062, 0.115156, 0.110312, 0.109062, 0.079219, 0.106406, 0.088125, 0.076875, 0.047812, 0.029375, 0.022969, 0.013437
#*# 	0.089687, 0.115937, 0.127656, 0.119531, 0.117656, 0.105937, 0.113594, 0.090156, 0.090000, 0.078437, 0.070312, 0.061562, 0.027969, 0.013594, 0.017187
#*# 	0.093906, 0.115781, 0.114531, 0.127656, 0.129219, 0.110156, 0.121406, 0.114531, 0.085625, 0.079062, 0.067187, 0.035000, 0.029375, 0.016719, 0.003594
#*# 	0.085469, 0.097344, 0.124219, 0.116094, 0.113125, 0.121094, 0.124844, 0.105156, 0.096094, 0.083125, 0.055469, 0.044531, 0.035469, 0.026562, 0.025625
#*# 	0.117187, 0.117812, 0.122500, 0.128281, 0.123750, 0.151875, 0.121562, 0.123594, 0.109375, 0.092812, 0.075469, 0.053437, 0.040000, 0.046250, 0.036875
#*# 	0.117969, 0.129531, 0.139062, 0.134219, 0.130156, 0.128750, 0.142187, 0.117031, 0.083437, 0.116875, 0.090000, 0.055625, 0.045781, 0.035625, 0.066719
#*# x_count = 15
#*# y_count = 15
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 20.0
#*# max_x = 269.90000000000003
#*# min_y = 30.0
#*# max_y = 227.39999999999995
#*#
#*# [bed_mesh ratos]
#*# version = 1
#*# points =
#*# 	  0.146250, 0.151089, 0.151287, 0.149324, 0.148028, 0.149675, 0.141416, 0.129106, 0.131848, 0.142742, 0.133711, 0.108694, 0.118265, 0.091418, 0.078695, 0.093255, 0.070304, 0.064570, 0.067774, 0.075312
#*# 	  0.147417, 0.150939, 0.153827, 0.159443, 0.172290, 0.166648, 0.158487, 0.146269, 0.125722, 0.127377, 0.128220, 0.121043, 0.099251, 0.101507, 0.098956, 0.077886, 0.050582, 0.046669, 0.048247, 0.044517
#*# 	  0.149006, 0.152566, 0.154344, 0.155629, 0.157736, 0.156241, 0.153164, 0.145585, 0.126955, 0.122125, 0.122295, 0.121746, 0.107163, 0.102875, 0.094546, 0.073520, 0.051910, 0.047800, 0.048199, 0.045485
#*# 	  0.151022, 0.154756, 0.159339, 0.159783, 0.148161, 0.152898, 0.150708, 0.141825, 0.131642, 0.123086, 0.119275, 0.117000, 0.105917, 0.091553, 0.080531, 0.070912, 0.049272, 0.043047, 0.042062, 0.040270
#*# 	  0.152520, 0.149571, 0.157143, 0.162110, 0.145954, 0.155759, 0.149637, 0.134409, 0.135246, 0.126022, 0.119653, 0.114694, 0.101105, 0.082814, 0.070789, 0.064604, 0.045100, 0.038777, 0.036447, 0.032317
#*# 	  0.150464, 0.130972, 0.134697, 0.144482, 0.138983, 0.150261, 0.138549, 0.118194, 0.132393, 0.126885, 0.122371, 0.120438, 0.112410, 0.095933, 0.077265, 0.055827, 0.051262, 0.050222, 0.047476, 0.039637
#*# 	  0.139167, 0.133176, 0.136146, 0.141330, 0.139958, 0.141620, 0.130268, 0.114618, 0.121666, 0.119103, 0.118230, 0.119742, 0.116095, 0.105812, 0.090151, 0.065815, 0.048893, 0.044952, 0.042671, 0.035050
#*# 	  0.126272, 0.135862, 0.142139, 0.140791, 0.123694, 0.127428, 0.115535, 0.100650, 0.124889, 0.135568, 0.127433, 0.104128, 0.093111, 0.085537, 0.079589, 0.071429, 0.050164, 0.038682, 0.033737, 0.033889
#*# 	  0.132787, 0.140203, 0.146677, 0.147101, 0.131913, 0.120835, 0.112988, 0.109516, 0.119814, 0.119995, 0.109790, 0.091179, 0.084063, 0.073607, 0.069472, 0.071272, 0.045551, 0.024510, 0.010720, 0.005753
#*# 	  0.133582, 0.134802, 0.142289, 0.147901, 0.138623, 0.121777, 0.117458, 0.119554, 0.115483, 0.108982, 0.099999, 0.088315, 0.084326, 0.071377, 0.062902, 0.060893, 0.047735, 0.024986, 0.003658, -0.010216
#*# 	  0.123186, 0.121722, 0.130110, 0.138581, 0.132765, 0.124797, 0.120761, 0.118404, 0.114639, 0.109999, 0.104191, 0.095932, 0.087741, 0.075600, 0.061483, 0.045359, 0.052323, 0.037802, 0.017516, 0.000291
#*# 	  0.123120, 0.122627, 0.124697, 0.127667, 0.128782, 0.118859, 0.112865, 0.110164, 0.109490, 0.088083, 0.087516, 0.104692, 0.090504, 0.081452, 0.069189, 0.047216, 0.032322, 0.025521, 0.020544, 0.013607
#*# 	  0.093754, 0.111538, 0.122528, 0.126670, 0.120883, 0.118231, 0.112667, 0.107224, 0.112530, 0.096133, 0.089061, 0.091060, 0.081331, 0.074515, 0.068553, 0.058738, 0.033550, 0.020013, 0.014877, 0.017018
#*# 	  0.092528, 0.111092, 0.117342, 0.119156, 0.125349, 0.127003, 0.119350, 0.109873, 0.118406, 0.112701, 0.101051, 0.085410, 0.079595, 0.072826, 0.061250, 0.041289, 0.031042, 0.021502, 0.013200, 0.006638
#*# 	  0.089118, 0.102196, 0.112523, 0.119805, 0.121753, 0.121627, 0.118613, 0.116098, 0.122743, 0.114951, 0.103425, 0.089479, 0.082228, 0.069017, 0.054622, 0.038541, 0.033447, 0.026343, 0.019364, 0.013962
#*# 	  0.093513, 0.099664, 0.112452, 0.123393, 0.119145, 0.115794, 0.121082, 0.129296, 0.124492, 0.114426, 0.106540, 0.098939, 0.087592, 0.070026, 0.056154, 0.046558, 0.038461, 0.034110, 0.031285, 0.028768
#*# 	  0.117669, 0.118915, 0.121658, 0.125334, 0.128943, 0.125145, 0.134865, 0.146586, 0.126181, 0.123376, 0.117855, 0.105528, 0.097206, 0.084888, 0.070842, 0.053053, 0.042632, 0.043033, 0.044316, 0.040431
#*# 	  0.117999, 0.126550, 0.133883, 0.137956, 0.134276, 0.130970, 0.129475, 0.131295, 0.140719, 0.126108, 0.105338, 0.086952, 0.112211, 0.101327, 0.080008, 0.054954, 0.047152, 0.039485, 0.042346, 0.065768
#*# 	  0.117969, 0.126809, 0.134336, 0.138437, 0.134464, 0.131178, 0.129243, 0.130676, 0.141274, 0.126197, 0.104837, 0.086226, 0.112769, 0.101932, 0.080334, 0.055015, 0.047318, 0.039332, 0.042246, 0.066719
#*# 	  0.117969, 0.126809, 0.134336, 0.138437, 0.134464, 0.131178, 0.129243, 0.130676, 0.141274, 0.126197, 0.104837, 0.086226, 0.112769, 0.101932, 0.080334, 0.055015, 0.047318, 0.039332, 0.042246, 0.066719
#*# x_count = 20
#*# y_count = 20
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 20.0
#*# max_x = 270.0
#*# min_y = 30.0
#*# max_y = 250.0
