#############################################################################################################
### CONFIGURATION GENERATED BY THE RATOS CONFIGURATOR
#############################################################################################################
[include RatOS.cfg]
[include filament_sensor.cfg]
[include user-macros.cfg]

[shaketune]
# result_folder: ~/printer_data/config/ShakeTune_results
#    The folder where the results will be stored. It will be created if it doesn't exist.
# number_of_results_to_keep: 3
#    The number of results to keep in the result_folder. The oldest results will
#    be automatically deleted after each runs.
# keep_raw_csv: False
#    If True, the raw CSV files will be kept in the result_folder alongside the
#    PNG graphs. If False, they will be deleted and only the graphs will be kept.
# show_macros_in_webui: True
#    Mainsail and Fluidd doesn't create buttons for "system" macros that are not in the
#    printer.cfg file. If you want to see the macros in the webui, set this to True.
# timeout: 300
#    The maximum time in seconds to let Shake&Tune process the CSV files and generate the graphs.

#############################################################################################################
### MACRO CONFIGURATION
### Configure the behavior of RatOS macros
### See: https://os.ratrig.com/docs/configuration/macros
#############################################################################################################
[gcode_macro RatOS]
variable_relative_extrusion: False
variable_preheat_extruder: True
variable_calibrate_bed_mesh: True
variable_nozzle_priming: "primeblob"
variable_start_print_park_in: "back"
variable_start_print_park_z_height: 50
variable_end_print_park_in: "back"
variable_pause_print_park_in: "back"
variable_macro_travel_speed: 600
variable_macro_travel_accel: 8000
variable_beacon_scan_compensation_enable: True          # Enables the beacon scan compensation

#############################################################################################################
### USER OVERRIDES & CUSTOM CONFIGURATION
### Anything custom you want to add, or RatOS configuration you want to override, do it here.
### This section is pre-populated with the most common settings you may want to change.
### See: https://os.ratrig.com/docs/configuration/includes-and-overrides
###
### It is recommended that you follow these steps to properly calibrate your printer:
### 0) Sanity check and PID Tuning: https://www.klipper3d.org/Config_checks.html
### 1) Z-offset calibration: run BEACON_RATOS_CALIBRATE to automatically calibrate your beacon for scan and contact.
###    IMPORTANT: Ensure the beacon is properly mounted and the nozzle and meltzone is clean by unloading
###    the filament (if it's loaded) and make sure there's no ooze or gunk on the nozzle when the hotend is at printing temperature.
### 2) Pressure Advance: https://www.klipper3d.org/Pressure_Advance.html
### 3) Skew Correction: https://www.klipper3d.org/Skew_Correction.html
### 4) Resonance Compensation: https://www.klipper3d.org/Resonance_Compensation.html
### RatOS has dedicated macro's to generate shaper graphs for deeper analysis (requires accelerometer).
### Use MEASURE_COREXY_BELT_TENSION to compare tension between belts, and use
### GENERATE_SHAPER_GRAPHS to generate the resonance graphs for analysing and manually entering input shaper
### configuration.
### You can run SHAPER_CALIBRATE to automatically calibrate your input shaper configuration, if you just want
### to get started.
### Additionally, you can use the Realtime Analysis Tool to analyze your printer's performance in real-time.
### Read more about klipper here: https://www.klipper3d.org/Overview.html
#############################################################################################################

#---------------------------------------------------- X -----------------------------------------------------
# The A motor in the CoreXY system, located at the rear left of the printer
#------------------------------------------------------------------------------------------------------------
[stepper_x]
dir_pin: x_dir_pin                # Add ! in front of pin name to reverse the direction of stepper_x
rotation_distance: 40             # 40 for 20 tooth 2GT pulleys, 32 for 16 tooth 2GT pulleys
homing_speed: 50
position_min: -60
position_max: 360
position_endstop: -60

#---------------------------------------------------- Y -----------------------------------------------------
# The B motor in the CoreXY system, located at the rear right of the printer
#------------------------------------------------------------------------------------------------------------
[stepper_y]
dir_pin: y_dir_pin                # Add ! in front of pin name to reverse the direction of stepper_y
rotation_distance: 40             # 40 for 20 tooth 2GT pulleys, 32 for 16 tooth 2GT pulleys
homing_speed: 50
position_min: -15
position_max: 330
position_endstop: -15

#---------------------------------------------------- Z -----------------------------------------------------
# The left Z motor for the kinematic bed
#------------------------------------------------------------------------------------------------------------
[stepper_z]
dir_pin: !z0_dir_pin              # Remove ! in front of pin name to reverse the direction of stepper_z
rotation_distance: 4              # 4 for TR8*4 lead screws
homing_speed: 10
position_min: -5
position_max: 300

#---------------------------------------------------- Z1 ----------------------------------------------------
# The rear Z motor for the kinematic bed
#------------------------------------------------------------------------------------------------------------
[stepper_z1]
dir_pin: !z1_dir_pin              # Remove ! in front of pin name to reverse the direction of stepper_z1
rotation_distance: 4              # 4 for TR8*4 lead screws

#---------------------------------------------------- Z2 ----------------------------------------------------
# The right Z motor for the kinematic bed
#------------------------------------------------------------------------------------------------------------
[stepper_z2]
dir_pin: !z2_dir_pin              # Remove ! in front of pin name to reverse the direction of stepper_z2
rotation_distance: 4              # 4 for TR8*4 lead screws

#------------------------------------------------- EXTRUDER -------------------------------------------------
# The extruder motor used for pushing filament through the toolhead
#------------------------------------------------------------------------------------------------------------
[extruder]
dir_pin: toolboard_t0:e_dir_pin   # Add ! in front of pin name to reverse the direction of extruder
rotation_distance: 4.63           # Orbiter 2 default
#pressure_advance: 0.05           # Check https://www.klipper3d.org/Pressure_Advance.html for pressure advance tuning.
#control: pid
#pid_kp: 28.413
#pid_ki: 1.334
#pid_kd: 151.300

[heater_bed]
#control: pid
#pid_Kp: 22.2
#pid_Ki: 1.08
#pid_Kd: 114

[led lightbars]
white_pin: PA2

[fan]
#pin: !toolboard_t0:PA0
pin: !PD15
enable_pin: PA3
cycle_time: 0.00004

[temperature_sensor chamber]
sensor_type: Generic 3950
sensor_pin: PF4
min_temp: 0
max_temp: 100
gcode_id: C

[input_shaper]
shaper_freq_x: 73.6 # center frequency for the X axis filter
shaper_type_x: mzv # filter type for the X axis
damping_ratio_x: 0.054 # damping ratio for the X axis
shaper_freq_y: 46.2 # center frequency for the Y axis filter
shaper_type_y: mzv # filter type for the Y axis
damping_ratio_y: 0.048 # damping ratio for the Y axis

[exclude_object]

# REMEMBER TO CALIBRATE YOUR BEACON!
# Run BEACON_RATOS_CALIBRATE for automatic calibration.

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [beacon model default]
#*# model_coef = 1.4624371793114677,
#*# 	  1.803529502923849,
#*# 	  0.8213524844742053,
#*# 	  0.384598472441789,
#*# 	  0.29823860669086755,
#*# 	  0.42347120911873276,
#*# 	  -0.0861296868899,
#*# 	  -0.4441046584603272,
#*# 	  0.10437338448343479,
#*# 	  0.23419989915801495
#*# model_domain = 1.8144026731283492e-07,1.92710340766697e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 40.716456
#*# model_offset = -0.00347
#*#
#*# [bed_mesh Contact]
#*# version = 1
#*# points =
#*# 	0.146250, 0.152344, 0.149687, 0.147969, 0.149531, 0.129062, 0.132344, 0.145937, 0.107812, 0.119375, 0.074219, 0.094531, 0.065156, 0.065625, 0.075312
#*# 	0.147656, 0.152031, 0.157500, 0.176719, 0.165781, 0.153437, 0.122187, 0.126562, 0.126250, 0.092187, 0.109844, 0.077031, 0.041719, 0.046406, 0.039375
#*# 	0.149687, 0.154375, 0.154531, 0.148750, 0.150781, 0.145937, 0.126719, 0.119687, 0.121406, 0.110312, 0.095469, 0.074219, 0.050156, 0.049844, 0.048281
#*# 	0.152500, 0.156406, 0.170781, 0.147187, 0.159844, 0.140156, 0.134844, 0.120625, 0.114844, 0.095625, 0.070781, 0.069375, 0.038125, 0.034375, 0.030469
#*# 	0.151562, 0.125937, 0.146094, 0.138594, 0.154219, 0.116719, 0.135156, 0.123750, 0.121250, 0.110000, 0.084062, 0.055312, 0.050937, 0.050000, 0.040000
#*# 	0.138281, 0.132344, 0.141250, 0.139844, 0.140312, 0.113594, 0.121719, 0.117187, 0.119844, 0.115312, 0.099375, 0.067812, 0.045156, 0.044375, 0.034687
#*# 	0.123750, 0.140312, 0.145625, 0.118906, 0.125000, 0.093594, 0.129062, 0.141406, 0.101562, 0.085000, 0.076719, 0.073750, 0.045312, 0.030625, 0.032500
#*# 	0.138750, 0.142812, 0.152656, 0.139687, 0.112969, 0.118437, 0.115156, 0.102031, 0.086719, 0.082500, 0.063281, 0.070781, 0.036250, 0.002187, -0.012031
#*# 	0.122969, 0.122031, 0.142187, 0.133125, 0.123437, 0.120781, 0.115312, 0.113594, 0.094531, 0.085625, 0.066250, 0.045156, 0.057969, 0.022812, -0.002656
#*# 	0.124062, 0.122812, 0.127187, 0.129062, 0.115156, 0.110312, 0.109062, 0.079219, 0.106406, 0.088125, 0.076875, 0.047812, 0.029375, 0.022969, 0.013437
#*# 	0.089687, 0.115937, 0.127656, 0.119531, 0.117656, 0.105937, 0.113594, 0.090156, 0.090000, 0.078437, 0.070312, 0.061562, 0.027969, 0.013594, 0.017187
#*# 	0.093906, 0.115781, 0.114531, 0.127656, 0.129219, 0.110156, 0.121406, 0.114531, 0.085625, 0.079062, 0.067187, 0.035000, 0.029375, 0.016719, 0.003594
#*# 	0.085469, 0.097344, 0.124219, 0.116094, 0.113125, 0.121094, 0.124844, 0.105156, 0.096094, 0.083125, 0.055469, 0.044531, 0.035469, 0.026562, 0.025625
#*# 	0.117187, 0.117812, 0.122500, 0.128281, 0.123750, 0.151875, 0.121562, 0.123594, 0.109375, 0.092812, 0.075469, 0.053437, 0.040000, 0.046250, 0.036875
#*# 	0.117969, 0.129531, 0.139062, 0.134219, 0.130156, 0.128750, 0.142187, 0.117031, 0.083437, 0.116875, 0.090000, 0.055625, 0.045781, 0.035625, 0.066719
#*# x_count = 15
#*# y_count = 15
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 20.0
#*# max_x = 269.90000000000003
#*# min_y = 30.0
#*# max_y = 227.39999999999995
#*#
#*# [bed_mesh ratos]
#*# version = 1
#*# points =
#*# 	  0.152940, 0.139179, 0.123114, 0.122263, 0.120237, 0.103760, 0.100249
#*# 	  0.149563, 0.138268, 0.126878, 0.119409, 0.115913, 0.101528, 0.083192
#*# 	  0.146844, 0.134316, 0.131235, 0.120165, 0.113373, 0.095649, 0.072712
#*# 	  0.134319, 0.122446, 0.130830, 0.122365, 0.119703, 0.108224, 0.084427
#*# 	  0.126919, 0.116377, 0.120685, 0.117805, 0.119302, 0.113604, 0.097463
#*# 	  0.111106, 0.107974, 0.132702, 0.130985, 0.101311, 0.088321, 0.079985
#*# 	  0.112888, 0.114361, 0.117858, 0.107682, 0.088741, 0.080698, 0.066917
#*# 	  0.118998, 0.118454, 0.112981, 0.103557, 0.088873, 0.081696, 0.063809
#*# 	  0.119454, 0.116190, 0.110463, 0.102461, 0.096459, 0.084657, 0.068078
#*# 	  0.112096, 0.109908, 0.100256, 0.085185, 0.101661, 0.085422, 0.074678
#*# 	  0.111754, 0.109263, 0.107002, 0.090085, 0.087936, 0.077411, 0.069793
#*# 	  0.118630, 0.113651, 0.118686, 0.105834, 0.084288, 0.077707, 0.065982
#*# 	  0.117110, 0.120674, 0.119458, 0.103688, 0.091191, 0.079121, 0.056738
#*# 	  0.129271, 0.133223, 0.120124, 0.113010, 0.101621, 0.085517, 0.065217
#*# 	  0.135709, 0.138810, 0.126476, 0.116694, 0.100595, 0.099359, 0.079579
#*# 	  0.129064, 0.134596, 0.135457, 0.108163, 0.088847, 0.114446, 0.088018
#*# 	  0.129064, 0.134596, 0.135457, 0.108163, 0.088847, 0.114446, 0.088018
#*# x_count = 7
#*# y_count = 17
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 100.329
#*# max_x = 199.671
#*# min_y = 52.8292
#*# max_y = 242.5
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 22.269
#*# pid_ki = 1.903
#*# pid_kd = 65.139
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 60.671
#*# pid_ki = 2.012
#*# pid_kd = 457.310
