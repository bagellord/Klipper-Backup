#############################################################################################################
### CONFIGURATION GENERATED BY THE RATOS CONFIGURATOR
#############################################################################################################
[include RatOS.cfg]
[include filament_sensor.cfg]
[include user-macros.cfg]

[shaketune]
# result_folder: ~/printer_data/config/ShakeTune_results
#    The folder where the results will be stored. It will be created if it doesn't exist.
# number_of_results_to_keep: 3
#    The number of results to keep in the result_folder. The oldest results will
#    be automatically deleted after each runs.
# keep_raw_csv: False
#    If True, the raw CSV files will be kept in the result_folder alongside the
#    PNG graphs. If False, they will be deleted and only the graphs will be kept.
# show_macros_in_webui: True
#    Mainsail and Fluidd doesn't create buttons for "system" macros that are not in the
#    printer.cfg file. If you want to see the macros in the webui, set this to True.
# timeout: 300
#    The maximum time in seconds to let Shake&Tune process the CSV files and generate the graphs.

#############################################################################################################
### MACRO CONFIGURATION
### Configure the behavior of RatOS macros
### See: https://os.ratrig.com/docs/configuration/macros
#############################################################################################################
[gcode_macro RatOS]
variable_relative_extrusion: False
variable_preheat_extruder: True
variable_calibrate_bed_mesh: True
variable_nozzle_priming: "primeblob"
variable_start_print_park_in: "back"
variable_start_print_park_z_height: 50
variable_end_print_park_in: "back"
variable_pause_print_park_in: "back"
variable_macro_travel_speed: 300
variable_macro_travel_accel: 3000

#############################################################################################################
### USER OVERRIDES & CUSTOM CONFIGURATION
### Anything custom you want to add, or RatOS configuration you want to override, do it here.
### This section is pre-populated with the most common settings you may want to change.
### See: https://os.ratrig.com/docs/configuration/includes-and-overrides
###
### It is recommended that you follow these steps to properly calibrate your printer:
### 0) Sanity check and PID Tuning: https://www.klipper3d.org/Config_checks.html
### 1) Z-offset calibration: Follow along from step 6 in the official beacon guide
###    https://docs.beacon3d.com/quickstart/#6-calibrate-beacon
### 2) Pressure Advance: https://www.klipper3d.org/Pressure_Advance.html
### 3) Skew Correction: https://www.klipper3d.org/Skew_Correction.html
### 4) Resonance Compensation: https://www.klipper3d.org/Resonance_Compensation.html
### RatOS has dedicated macro's to generate shaper graphs for deeper analysis (requires accelerometer).
### Use MEASURE_COREXY_BELT_TENSION to compare tension between belts, and use
### GENERATE_SHAPER_GRAPHS to generate the resonance graphs for analysing and manually entering input shaper
### configuration.
### You can run SHAPER_CALIBRATE to automatically calibrate your input shaper configuration, if you just want
### to get started.
### Additionally, you can use the Realtime Analysis Tool to analyze your printer's performance in real-time.
### Read more about klipper here: https://www.klipper3d.org/Overview.html
#############################################################################################################

#---------------------------------------------------- X -----------------------------------------------------
# The A motor in the CoreXY system, located at the rear left of the printer
# Connected to MOTOR 0 on Octopus V1.1
#------------------------------------------------------------------------------------------------------------
[stepper_x]
dir_pin: x_dir_pin                 # Add ! in front of pin name to reverse the direction of stepper_x
rotation_distance: 40              # 40 for 20 tooth 2GT pulleys, 32 for 16 tooth 2GT pulleys
homing_speed: 50
position_min: -60
position_max: 360
position_endstop: -60

#---------------------------------------------------- Y -----------------------------------------------------
# The B motor in the CoreXY system, located at the rear right of the printer
# Connected to MOTOR 1 on Octopus V1.1
#------------------------------------------------------------------------------------------------------------
[stepper_y]
dir_pin: y_dir_pin                 # Add ! in front of pin name to reverse the direction of stepper_y
rotation_distance: 40              # 40 for 20 tooth 2GT pulleys, 32 for 16 tooth 2GT pulleys
homing_speed: 50
position_min: -15
position_max: 330
position_endstop: -15

#---------------------------------------------------- Z -----------------------------------------------------
# The left Z motor for the kinematic bed
# Connected to MOTOR 5 on Octopus V1.1
#------------------------------------------------------------------------------------------------------------
[stepper_z]
dir_pin: !z0_dir_pin               # Remove ! in front of pin name to reverse the direction of stepper_z
rotation_distance: 4               # 4 for TR8*4 lead screws
homing_speed: 10
position_min: -5
position_max: 300

#---------------------------------------------------- Z1 ----------------------------------------------------
# The rear Z motor for the kinematic bed
# Connected to MOTOR 6 on Octopus V1.1
#------------------------------------------------------------------------------------------------------------
[stepper_z1]
dir_pin: !z1_dir_pin               # Remove ! in front of pin name to reverse the direction of stepper_z1
rotation_distance: 4               # 4 for TR8*4 lead screws

#---------------------------------------------------- Z2 ----------------------------------------------------
# The right Z motor for the kinematic bed
# Connected to MOTOR 7 on Octopus V1.1
#------------------------------------------------------------------------------------------------------------
[stepper_z2]
dir_pin: !z2_dir_pin               # Remove ! in front of pin name to reverse the direction of stepper_z2
rotation_distance: 4               # 4 for TR8*4 lead screws

#------------------------------------------------- EXTRUDER -------------------------------------------------
# The extruder motor used for pushing filament through the toolhead
# Connected to EBB42 v1.2
#------------------------------------------------------------------------------------------------------------
[extruder]
dir_pin: toolboard_t0:e_dir_pin   # Remove ! in front of pin name to reverse the direction of extruder
rotation_distance: 4.63            # Orbiter 2 default
#pressure_advance: 0.05            # Check https://www.klipper3d.org/Pressure_Advance.html for pressure advance tuning.
#control: pid
#pid_kp: 28.413
#pid_ki: 1.334
#pid_kd: 151.300


[heater_bed]
#control: pid
#pid_Kp: 22.2
#pid_Ki: 1.08
#pid_Kd: 114

[input_shaper]
shaper_freq_x: 72.8 # center frequency for the X axis filter
shaper_type_x: mzv # filter type for the X axis
shaper_freq_y: 46.2 # center frequency for the Y axis filter
shaper_type_y: mzv # filter type for the Y axis
damping_ratio_x: 0.034 # damping ratio for the X axis
damping_ratio_y: 0.038 # damping ratio for the Y axis

[exclude_object]

[printer]
max_velocity: 700
max_accel: 20000

[led lightbars]
white_pin: PA2

[fan]
#pin: !toolboard_t0:PA0
pin: !PD15
enable_pin: PA3
cycle_time: 0.00004

[temperature_sensor chamber]
sensor_type: Generic 3950
sensor_pin: PF4
min_temp: 0
max_temp: 100
gcode_id: C

# REMEMBER TO CALIBRATE YOUR BEACON!
# Follow along from step 6 in the official beacon guide https://docs.beacon3d.com/quickstart/#6-calibrate-beacon

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [beacon model default]
#*# model_coef = 1.4601030586245216,
#*# 	  1.7949095547109146,
#*# 	  0.8135539508723441,
#*# 	  0.419108598026989,
#*# 	  0.3072978113984354,
#*# 	  0.31599539608070115,
#*# 	  -0.08703400435364615,
#*# 	  -0.3116473891084393,
#*# 	  0.10621593207657236,
#*# 	  0.18303979558720673
#*# model_domain = 1.814079869071053e-07,1.9271485873655481e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 46.762571
#*# model_offset = 0.00000
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 21.523
#*# pid_ki = 1.729
#*# pid_kd = 66.992
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 61.633
#*# pid_ki = 1.966
#*# pid_kd = 483.049
#*#
#*# [bed_mesh ratos]
#*# version = 1
#*# points =
#*# 	  0.075657, 0.078457, 0.091327, 0.104468, 0.112010, 0.117956, 0.116732, 0.115495, 0.114364, 0.110996, 0.112216, 0.107159, 0.097498, 0.096255, 0.096579, 0.081567, 0.069833, 0.081096, 0.076798
#*# 	  0.055450, 0.063766, 0.079457, 0.091404, 0.101320, 0.108127, 0.109835, 0.106240, 0.102437, 0.100672, 0.099191, 0.097026, 0.089292, 0.083731, 0.080865, 0.067435, 0.056049, 0.064284, 0.059507
#*# 	  0.038793, 0.038788, 0.052227, 0.061883, 0.071492, 0.081570, 0.085373, 0.081360, 0.084119, 0.084005, 0.083714, 0.083598, 0.077797, 0.073381, 0.071153, 0.057671, 0.050851, 0.060207, 0.059263
#*# 	  0.020155, 0.025633, 0.040679, 0.051652, 0.060724, 0.069245, 0.071738, 0.069685, 0.074134, 0.074206, 0.075618, 0.074289, 0.066616, 0.060984, 0.059555, 0.045015, 0.042572, 0.049604, 0.046256
#*# 	  0.009843, 0.015070, 0.028865, 0.039135, 0.046304, 0.057470, 0.059179, 0.058452, 0.065738, 0.065810, 0.065934, 0.063588, 0.056036, 0.052000, 0.050393, 0.036972, 0.032649, 0.037615, 0.035356
#*# 	  0.003252, 0.007927, 0.020780, 0.031829, 0.037175, 0.047326, 0.050082, 0.050112, 0.056865, 0.058693, 0.057377, 0.054130, 0.047768, 0.045090, 0.041686, 0.029536, 0.024454, 0.028784, 0.026144
#*# 	  -0.004548, 0.002039, 0.014966, 0.024189, 0.028086, 0.040217, 0.043986, 0.042479, 0.049052, 0.053861, 0.050707, 0.046876, 0.043681, 0.040341, 0.037340, 0.023999, 0.019268, 0.023304, 0.019053
#*# 	  -0.011584, -0.003388, 0.010397, 0.017858, 0.022354, 0.034523, 0.037494, 0.036854, 0.042883, 0.047378, 0.040540, 0.037743, 0.034958, 0.031925, 0.029686, 0.016922, 0.013452, 0.017605, 0.011904
#*# 	  -0.020890, -0.014157, -0.000419, 0.008252, 0.013506, 0.025286, 0.028193, 0.029145, 0.035688, 0.037655, 0.031282, 0.028964, 0.027004, 0.024572, 0.020715, 0.009070, 0.003604, 0.009778, 0.004516
#*# 	  -0.029336, -0.023810, -0.010035, 0.001390, 0.005108, 0.016849, 0.017327, 0.020061, 0.025651, 0.025797, 0.019662, 0.019851, 0.016373, 0.014486, 0.008966, -0.002829, -0.006944, -0.002547, -0.009377
#*# 	  -0.039832, -0.035167, -0.022243, -0.007592, -0.003624, 0.007489, 0.008882, 0.011192, 0.015828, 0.016594, 0.012551, 0.013840, 0.009729, 0.005373, 0.001597, -0.010474, -0.015698, -0.010664, -0.018807
#*# 	  -0.045313, -0.040209, -0.026720, -0.013500, -0.008963, 0.002701, 0.001496, 0.004318, 0.009602, 0.010179, 0.007179, 0.010178, 0.004542, 0.001129, -0.004709, -0.018350, -0.023738, -0.020326, -0.026351
#*# 	  -0.056605, -0.048924, -0.033253, -0.021282, -0.017320, -0.006097, -0.005449, -0.001799, 0.005720, 0.006752, 0.004906, 0.005854, 0.001095, -0.002338, -0.008234, -0.021537, -0.027628, -0.024612, -0.030291
#*# 	  -0.067784, -0.056852, -0.040931, -0.028396, -0.025860, -0.012442, -0.010768, -0.006383, 0.002792, 0.003753, 0.001259, 0.002344, -0.003367, -0.008163, -0.014680, -0.028705, -0.032355, -0.028260, -0.033840
#*# 	  -0.069835, -0.060185, -0.044037, -0.034108, -0.032118, -0.017706, -0.012842, -0.006859, 0.001298, 0.000986, -0.000333, 0.001030, -0.002000, -0.006068, -0.013271, -0.027548, -0.030995, -0.025579, -0.030367
#*# 	  -0.070516, -0.060155, -0.044256, -0.036084, -0.034586, -0.017935, -0.012845, -0.006284, 0.000906, -0.000569, -0.001191, -0.001213, -0.002861, -0.006975, -0.014919, -0.025395, -0.030775, -0.022374, -0.024908
#*# 	  -0.069925, -0.061419, -0.045775, -0.036566, -0.033329, -0.016923, -0.011638, -0.007462, 0.002785, 0.002117, -0.001325, -0.000224, -0.001127, -0.000974, -0.006982, -0.016115, -0.023562, -0.013242, -0.015874
#*# 	  -0.069439, -0.061949, -0.045722, -0.035598, -0.027809, -0.012618, -0.006790, -0.003891, 0.001530, 0.000967, 0.000912, 0.004311, 0.002902, 0.003102, -0.002217, -0.009227, -0.014815, -0.003740, -0.007416
#*# 	  -0.064554, -0.058046, -0.041582, -0.028000, -0.018028, -0.004935, 0.003548, 0.003459, 0.006622, 0.007907, 0.007937, 0.014362, 0.015135, 0.014255, 0.011128, 0.004008, -0.000883, 0.009304, 0.006765
#*# 	  -0.059362, -0.051620, -0.032897, -0.015294, -0.004497, 0.008047, 0.012928, 0.009986, 0.014217, 0.014272, 0.017251, 0.025004, 0.025268, 0.022872, 0.020879, 0.013860, 0.009727, 0.018431, 0.016741
#*# x_count = 19
#*# y_count = 20
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 21.3388
#*# max_x = 270.0
#*# min_y = 30.0
#*# max_y = 250.0
#*#
#*# [bed_mesh Contact]
#*# version = 1
#*# points =
#*# 	0.028229, 0.042135, 0.076198, 0.103698, 0.104323, 0.095573, 0.104323, 0.088229, 0.091510, 0.096354, 0.086042, 0.077917, 0.066510, 0.059167, 0.076823
#*# 	0.019167, 0.052292, 0.080573, 0.093854, 0.106979, 0.095885, 0.087292, 0.090729, 0.097760, 0.084948, 0.075885, 0.075729, 0.055417, 0.053542, 0.050417
#*# 	0.027760, 0.046042, 0.076510, 0.082917, 0.085104, 0.085417, 0.090417, 0.082448, 0.090573, 0.079948, 0.064792, 0.045104, 0.047448, 0.040729, 0.041198
#*# 	0.047135, 0.034635, 0.058385, 0.061667, 0.069167, 0.080573, 0.074010, 0.085573, 0.086979, 0.078542, 0.057135, 0.044792, 0.032292, 0.025260, 0.010260
#*# 	0.019323, 0.041667, 0.050260, 0.077917, 0.081510, 0.085885, 0.089167, 0.079792, 0.057604, 0.053542, 0.050417, 0.048385, 0.015573, 0.001979, -0.010208
#*# 	0.028385, 0.052448, 0.059635, 0.052917, 0.065104, 0.087760, 0.071354, 0.081042, 0.055104, 0.055417, 0.053073, 0.031823, 0.012917, 0.005260, -0.017083
#*# 	0.038229, 0.033385, 0.049792, 0.064948, 0.073073, 0.065417, 0.065104, 0.061823, 0.051042, 0.046667, 0.021042, 0.004323, -0.009115, -0.021146, -0.024115
#*# 	0.009479, 0.040729, 0.054167, 0.059323, 0.061823, 0.069635, 0.059635, 0.066354, 0.029010, 0.034010, -0.002083, 0.003073, -0.024896, -0.040833, -0.053958
#*# 	0.012448, 0.028229, 0.041354, 0.061042, 0.047760, 0.052448, 0.060573, 0.042135, 0.029167, 0.005729, 0.011823, -0.015365, -0.032552, -0.053177, -0.068958
#*# 	0.025573, 0.028385, 0.037604, 0.048385, 0.046354, 0.044010, 0.037604, 0.038698, 0.026198, 0.014323, 0.000104, -0.011458, -0.055052, -0.069896, -0.090833
#*# 	0.008542, 0.026198, 0.039479, 0.049635, 0.061979, 0.034948, 0.030885, 0.024010, 0.021823, 0.000885, -0.020208, -0.036458, -0.068177, -0.092396, -0.096146
#*# 	0.025885, 0.018854, 0.027135, 0.030104, 0.032448, 0.040573, 0.029323, 0.021198, 0.014792, 0.005573, -0.024740, -0.052396, -0.080208, -0.092396, -0.115677
#*# 	0.025260, 0.039010, 0.046042, 0.048229, 0.039323, 0.034792, 0.044792, 0.021667, -0.008333, 0.003854, -0.023958, -0.049896, -0.068490, -0.098177, -0.131458
#*# 	0.024167, 0.042135, 0.054948, 0.041198, 0.044323, 0.056667, 0.043542, 0.056510, 0.028229, -0.012865, -0.025052, -0.063802, -0.074115, -0.110521, -0.124427
#*# 	0.054479, 0.051510, 0.060417, 0.059792, 0.065885, 0.042760, 0.046823, 0.021510, 0.017292, -0.016146, -0.023021, -0.053958, -0.086302, -0.111615, -0.115521
#*# x_count = 15
#*# y_count = 15
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 20.0
#*# max_x = 269.9
#*# min_y = 30.0
#*# max_y = 227.4
