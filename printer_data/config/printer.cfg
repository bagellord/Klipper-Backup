#############################################################################################################
### CONFIGURATION GENERATED BY THE RATOS CONFIGURATOR
#############################################################################################################
[include RatOS.cfg]
[include filament_sensor.cfg]
[include user-macros.cfg]

[shaketune]
# result_folder: ~/printer_data/config/ShakeTune_results
#    The folder where the results will be stored. It will be created if it doesn't exist.
# number_of_results_to_keep: 3
#    The number of results to keep in the result_folder. The oldest results will
#    be automatically deleted after each runs.
# keep_raw_csv: False
#    If True, the raw CSV files will be kept in the result_folder alongside the
#    PNG graphs. If False, they will be deleted and only the graphs will be kept.
# show_macros_in_webui: True
#    Mainsail and Fluidd doesn't create buttons for "system" macros that are not in the
#    printer.cfg file. If you want to see the macros in the webui, set this to True.
# timeout: 300
#    The maximum time in seconds to let Shake&Tune process the CSV files and generate the graphs.

#############################################################################################################
### MACRO CONFIGURATION
### Configure the behavior of RatOS macros
### See: https://os.ratrig.com/docs/configuration/macros
#############################################################################################################
[gcode_macro RatOS]
variable_relative_extrusion: False
variable_preheat_extruder: True
variable_calibrate_bed_mesh: True
variable_nozzle_priming: "primeblob"
variable_start_print_park_in: "back"
variable_start_print_park_z_height: 50
variable_end_print_park_in: "back"
variable_pause_print_park_in: "back"
variable_macro_travel_speed: 600
variable_macro_travel_accel: 8000
variable_beacon_scan_compensation_enable: True          # Enables the beacon scan compensation
variable_beacon_scan_compensation_profile: "Contact"     # The contact profile name for the scan compensation
variable_beacon_scan_compensation_probe_count: 25,25     # The contact probe count for the scan compensation
#variable_beacon_contact_z_calibration: True

#############################################################################################################
### USER OVERRIDES & CUSTOM CONFIGURATION
### Anything custom you want to add, or RatOS configuration you want to override, do it here.
### This section is pre-populated with the most common settings you may want to change.
### See: https://os.ratrig.com/docs/configuration/includes-and-overrides
###
### It is recommended that you follow these steps to properly calibrate your printer:
### 0) Sanity check and PID Tuning: https://www.klipper3d.org/Config_checks.html
### 1) Z-offset calibration: run BEACON_RATOS_CALIBRATE to automatically calibrate your beacon for scan and contact.
###    IMPORTANT: Ensure the beacon is properly mounted and the nozzle and meltzone is clean by unloading
###    the filament (if it's loaded) and make sure there's no ooze or gunk on the nozzle when the hotend is at printing temperature.
### 2) Pressure Advance: https://www.klipper3d.org/Pressure_Advance.html
### 3) Skew Correction: https://www.klipper3d.org/Skew_Correction.html
### 4) Resonance Compensation: https://www.klipper3d.org/Resonance_Compensation.html
### RatOS has dedicated macro's to generate shaper graphs for deeper analysis (requires accelerometer).
### Use MEASURE_COREXY_BELT_TENSION to compare tension between belts, and use
### GENERATE_SHAPER_GRAPHS to generate the resonance graphs for analysing and manually entering input shaper
### configuration.
### You can run SHAPER_CALIBRATE to automatically calibrate your input shaper configuration, if you just want
### to get started.
### Additionally, you can use the Realtime Analysis Tool to analyze your printer's performance in real-time.
### Read more about klipper here: https://www.klipper3d.org/Overview.html
#############################################################################################################

#---------------------------------------------------- X -----------------------------------------------------
# The A motor in the CoreXY system, located at the rear left of the printer
#------------------------------------------------------------------------------------------------------------
[stepper_x]
dir_pin: x_dir_pin                # Add ! in front of pin name to reverse the direction of stepper_x
rotation_distance: 40             # 40 for 20 tooth 2GT pulleys, 32 for 16 tooth 2GT pulleys
homing_speed: 50
position_min: -60
position_max: 360
position_endstop: -60

#---------------------------------------------------- Y -----------------------------------------------------
# The B motor in the CoreXY system, located at the rear right of the printer
#------------------------------------------------------------------------------------------------------------
[stepper_y]
dir_pin: y_dir_pin                # Add ! in front of pin name to reverse the direction of stepper_y
rotation_distance: 40             # 40 for 20 tooth 2GT pulleys, 32 for 16 tooth 2GT pulleys
homing_speed: 50
position_min: -15
position_max: 330
position_endstop: -15

#---------------------------------------------------- Z -----------------------------------------------------
# The left Z motor for the kinematic bed
#------------------------------------------------------------------------------------------------------------
[stepper_z]
dir_pin: !z0_dir_pin              # Remove ! in front of pin name to reverse the direction of stepper_z
rotation_distance: 4              # 4 for TR8*4 lead screws
homing_speed: 10
position_min: -5
position_max: 300

#---------------------------------------------------- Z1 ----------------------------------------------------
# The rear Z motor for the kinematic bed
#------------------------------------------------------------------------------------------------------------
[stepper_z1]
dir_pin: !z1_dir_pin              # Remove ! in front of pin name to reverse the direction of stepper_z1
rotation_distance: 4              # 4 for TR8*4 lead screws

#---------------------------------------------------- Z2 ----------------------------------------------------
# The right Z motor for the kinematic bed
#------------------------------------------------------------------------------------------------------------
[stepper_z2]
dir_pin: !z2_dir_pin              # Remove ! in front of pin name to reverse the direction of stepper_z2
rotation_distance: 4              # 4 for TR8*4 lead screws

#------------------------------------------------- EXTRUDER -------------------------------------------------
# The extruder motor used for pushing filament through the toolhead
#------------------------------------------------------------------------------------------------------------
[extruder]
dir_pin: toolboard_t0:e_dir_pin   # Add ! in front of pin name to reverse the direction of extruder
rotation_distance: 4.63           # Orbiter 2 default
#pressure_advance: 0.05           # Check https://www.klipper3d.org/Pressure_Advance.html for pressure advance tuning.
#control: pid
#pid_kp: 28.413
#pid_ki: 1.334
#pid_kd: 151.300

[heater_bed]
#control: pid
#pid_Kp: 22.2
#pid_Ki: 1.08
#pid_Kd: 114

[led lightbars]
white_pin: PA2

[fan]
#pin: !toolboard_t0:PA0
pin: !PD15
enable_pin: PA3
cycle_time: 0.00004

[temperature_sensor chamber]
sensor_type: Generic 3950
sensor_pin: PF4
min_temp: 0
max_temp: 100
gcode_id: C

[input_shaper]
shaper_freq_x: 78.2 # center frequency for the X axis filter
shaper_type_x: mzv # filter type for the X axis
damping_ratio_x: 0.041 # damping ratio for the X axis
shaper_freq_y: 41.6 # center frequency for the Y axis filter
shaper_type_y: mzv # filter type for the Y axis
damping_ratio_y: 0.044 # damping ratio for the Y axis

[exclude_object]

[bed_mesh]
probe_count: 75,75

[printer]
max_z_velocity: 50
max_z_accel: 30

# REMEMBER TO CALIBRATE YOUR BEACON!
# Run BEACON_RATOS_CALIBRATE for automatic calibration.

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 22.269
#*# pid_ki = 1.903
#*# pid_kd = 65.139
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 60.671
#*# pid_ki = 2.012
#*# pid_kd = 457.310
#*#
#*# [beacon model default]
#*# model_coef = 1.4649304820888451,
#*# 	  1.7993461986224246,
#*# 	  0.8146290879132821,
#*# 	  0.4304968745520872,
#*# 	  0.33766819614424964,
#*# 	  0.2856155008141192,
#*# 	  -0.1586490160153065,
#*# 	  -0.29746653092312775,
#*# 	  0.14117922216524673,
#*# 	  0.1829403736423541
#*# model_domain = 1.8150458110012543e-07,1.92720884501772e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 42.393096
#*# model_offset = 0.00000
#*#
#*# [bed_mesh Contact]
#*# version = 1
#*# points =
#*# 	  0.189948, 0.198385, 0.198542, 0.184010, 0.184792, 0.178854, 0.188073, 0.187292, 0.163854, 0.161042, 0.198385, 0.163542, 0.161979, 0.159635, 0.145417, 0.155260, 0.147917, 0.150885, 0.144479, 0.141042, 0.123698, 0.137135, 0.113073, 0.109167, 0.128229
#*# 	  0.197448, 0.202135, 0.215729, 0.205729, 0.199479, 0.209792, 0.206667, 0.193542, 0.190573, 0.186979, 0.192292, 0.184167, 0.183698, 0.154167, 0.155417, 0.153385, 0.132292, 0.124167, 0.129635, 0.145104, 0.115885, 0.129635, 0.126510, 0.120417, 0.111667
#*# 	  0.210885, 0.202448, 0.208542, 0.201823, 0.208385, 0.214479, 0.199323, 0.199635, 0.201042, 0.199010, 0.165260, 0.187292, 0.174479, 0.184167, 0.154479, 0.147292, 0.157135, 0.149167, 0.117760, 0.134167, 0.136510, 0.119167, 0.139635, 0.122760, 0.114948
#*# 	  0.221979, 0.214167, 0.207448, 0.228854, 0.226667, 0.202760, 0.200573, 0.200104, 0.185885, 0.196979, 0.160573, 0.162760, 0.176979, 0.163073, 0.144635, 0.139948, 0.154792, 0.143698, 0.150260, 0.143229, 0.127135, 0.131042, 0.111979, 0.109948, 0.117917
#*# 	  0.188073, 0.194167, 0.196354, 0.197292, 0.194948, 0.217917, 0.196979, 0.194323, 0.196198, 0.188229, 0.188229, 0.183385, 0.160104, 0.173385, 0.158542, 0.157760, 0.146667, 0.135573, 0.140573, 0.128542, 0.118385, 0.111198, 0.118542, 0.115417, 0.115573
#*# 	  0.184792, 0.201198, 0.213385, 0.197135, 0.199167, 0.197917, 0.200729, 0.203854, 0.200573, 0.188073, 0.157604, 0.173542, 0.175729, 0.166198, 0.141979, 0.149948, 0.177448, 0.142917, 0.136667, 0.127448, 0.109635, 0.113542, 0.092917, 0.092760, 0.124010
#*# 	  0.197292, 0.183542, 0.198854, 0.214167, 0.216198, 0.213073, 0.207135, 0.194792, 0.187917, 0.190417, 0.178854, 0.181823, 0.167135, 0.153073, 0.156979, 0.150260, 0.157292, 0.143073, 0.120104, 0.148229, 0.114010, 0.109323, 0.099792, 0.105729, 0.108698
#*# 	  0.187135, 0.190729, 0.220573, 0.191354, 0.214635, 0.220729, 0.213854, 0.210729, 0.191823, 0.174323, 0.181198, 0.159323, 0.168073, 0.178385, 0.164010, 0.142292, 0.145260, 0.151198, 0.126823, 0.114323, 0.118229, 0.101510, 0.090885, 0.108542, 0.094635
#*# 	  0.190417, 0.206510, 0.196198, 0.209323, 0.194010, 0.196823, 0.214167, 0.205104, 0.199479, 0.169479, 0.199167, 0.182292, 0.187135, 0.178542, 0.165104, 0.158854, 0.159323, 0.148385, 0.157604, 0.128073, 0.103073, 0.104010, 0.120417, 0.096354, 0.081667
#*# 	  0.193698, 0.190573, 0.218542, 0.192292, 0.216823, 0.184010, 0.193854, 0.191042, 0.182760, 0.170104, 0.161042, 0.189323, 0.171510, 0.162292, 0.166042, 0.150260, 0.141979, 0.126979, 0.124010, 0.125104, 0.106198, 0.088229, 0.082292, 0.091667, 0.081979
#*# 	  0.205260, 0.195885, 0.199792, 0.201510, 0.188854, 0.193854, 0.213073, 0.183385, 0.187448, 0.177604, 0.183698, 0.180260, 0.156667, 0.164479, 0.157135, 0.152917, 0.134010, 0.156510, 0.146198, 0.124323, 0.116823, 0.100260, 0.092917, 0.084948, 0.075885
#*# 	  0.208073, 0.197760, 0.193698, 0.191354, 0.221979, 0.188385, 0.186198, 0.175573, 0.166198, 0.154479, 0.162917, 0.161823, 0.157917, 0.137292, 0.145417, 0.120417, 0.129792, 0.115729, 0.152604, 0.120104, 0.095885, 0.082604, 0.090417, 0.070885, 0.078542
#*# 	  0.182292, 0.187604, 0.189948, 0.195417, 0.182448, 0.191354, 0.170104, 0.181198, 0.181198, 0.159792, 0.164792, 0.151198, 0.147292, 0.154167, 0.157604, 0.129167, 0.123698, 0.130417, 0.131667, 0.105417, 0.100417, 0.089010, 0.075260, 0.049792, 0.056979
#*# 	  0.185417, 0.193073, 0.202448, 0.189948, 0.197292, 0.174792, 0.189635, 0.160260, 0.161510, 0.171823, 0.156667, 0.155573, 0.158073, 0.128229, 0.125417, 0.132917, 0.123385, 0.129948, 0.126667, 0.128542, 0.116198, 0.090417, 0.075573, 0.075885, 0.058854
#*# 	  0.184167, 0.160573, 0.197292, 0.198542, 0.193542, 0.182448, 0.182604, 0.185885, 0.184635, 0.147135, 0.168854, 0.153854, 0.170417, 0.151510, 0.126354, 0.122917, 0.134010, 0.123698, 0.116823, 0.105573, 0.103854, 0.085729, 0.069635, 0.073854, 0.075260
#*# 	  0.160417, 0.162604, 0.190104, 0.178229, 0.197448, 0.193542, 0.181510, 0.183542, 0.176667, 0.170573, 0.149323, 0.158698, 0.149948, 0.145885, 0.128854, 0.142135, 0.133229, 0.119323, 0.120417, 0.111667, 0.080729, 0.073073, 0.083385, 0.057292, 0.055885
#*# 	  0.183698, 0.181198, 0.174635, 0.183854, 0.180573, 0.178854, 0.186354, 0.169323, 0.162292, 0.158073, 0.147604, 0.149479, 0.140417, 0.130260, 0.126510, 0.133229, 0.123698, 0.111823, 0.111354, 0.099948, 0.094479, 0.083698, 0.081354, 0.060573, 0.045573
#*# 	  0.178698, 0.185104, 0.188385, 0.181667, 0.178542, 0.187604, 0.154792, 0.168385, 0.142135, 0.141667, 0.179323, 0.147760, 0.138542, 0.135573, 0.127135, 0.130729, 0.124792, 0.123542, 0.093073, 0.109323, 0.084948, 0.075104, 0.061510, 0.066823, 0.045260
#*# 	  0.148542, 0.160260, 0.182292, 0.173229, 0.180885, 0.156667, 0.172448, 0.145885, 0.149948, 0.139010, 0.154948, 0.153542, 0.129010, 0.130260, 0.136198, 0.134479, 0.118698, 0.121979, 0.114635, 0.089323, 0.086354, 0.061198, 0.060104, 0.065104, 0.052917
#*# 	  0.166979, 0.164167, 0.157292, 0.170104, 0.167917, 0.162292, 0.153073, 0.159948, 0.138854, 0.162135, 0.149010, 0.134948, 0.146979, 0.109948, 0.134948, 0.114635, 0.138073, 0.106979, 0.125104, 0.079635, 0.079010, 0.081042, 0.055573, 0.046823, 0.083073
#*# 	  0.143542, 0.170729, 0.159792, 0.179167, 0.165104, 0.159792, 0.157448, 0.167917, 0.132448, 0.150885, 0.139635, 0.145573, 0.149635, 0.154792, 0.124010, 0.126510, 0.125885, 0.110573, 0.106979, 0.094167, 0.088542, 0.058542, 0.064323, 0.076823, 0.055417
#*# 	  0.167604, 0.189479, 0.168073, 0.177135, 0.178385, 0.174479, 0.165729, 0.150104, 0.148698, 0.158385, 0.155729, 0.173073, 0.150104, 0.144948, 0.136667, 0.156510, 0.127292, 0.120885, 0.123229, 0.085104, 0.065260, 0.087917, 0.085729, 0.080260, 0.086823
#*# 	  0.162917, 0.174323, 0.167292, 0.169792, 0.180885, 0.171510, 0.177760, 0.156979, 0.175729, 0.154792, 0.140573, 0.152604, 0.161198, 0.151042, 0.145573, 0.125729, 0.119323, 0.112448, 0.096354, 0.090573, 0.070885, 0.066979, 0.060885, 0.059010, 0.060417
#*# 	  0.179010, 0.154635, 0.174635, 0.150104, 0.175417, 0.181198, 0.155573, 0.158542, 0.157917, 0.153073, 0.158698, 0.142448, 0.136979, 0.135729, 0.131354, 0.112292, 0.127135, 0.126667, 0.097917, 0.080260, 0.097917, 0.071510, 0.075729, 0.080417, 0.091979
#*# 	  0.161198, 0.171823, 0.174792, 0.180885, 0.163229, 0.183698, 0.163542, 0.142604, 0.153229, 0.142448, 0.150104, 0.148385, 0.147292, 0.131042, 0.101042, 0.133854, 0.126979, 0.120417, 0.106354, 0.077917, 0.103073, 0.081510, 0.089479, 0.072135, 0.077604
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 20.0
#*# max_x = 269.84000000000003
#*# min_y = 30.0
#*# max_y = 227.27999999999997
