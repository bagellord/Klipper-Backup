#############################################################################################################
### CONFIGURATION GENERATED BY THE RATOS CONFIGURATOR
#############################################################################################################
[include RatOS.cfg]
[include filament_sensor.cfg]
[include user-macros.cfg]

[shaketune]
# result_folder: ~/printer_data/config/ShakeTune_results
#    The folder where the results will be stored. It will be created if it doesn't exist.
# number_of_results_to_keep: 3
#    The number of results to keep in the result_folder. The oldest results will
#    be automatically deleted after each runs.
# keep_raw_csv: False
#    If True, the raw CSV files will be kept in the result_folder alongside the
#    PNG graphs. If False, they will be deleted and only the graphs will be kept.
# show_macros_in_webui: True
#    Mainsail and Fluidd doesn't create buttons for "system" macros that are not in the
#    printer.cfg file. If you want to see the macros in the webui, set this to True.
# timeout: 300
#    The maximum time in seconds to let Shake&Tune process the CSV files and generate the graphs.

#############################################################################################################
### MACRO CONFIGURATION
### Configure the behavior of RatOS macros
### See: https://os.ratrig.com/docs/configuration/macros
#############################################################################################################
[gcode_macro RatOS]
variable_relative_extrusion: False
variable_preheat_extruder: True
variable_calibrate_bed_mesh: True
variable_nozzle_priming: "primeblob"
variable_start_print_park_in: "back"
variable_start_print_park_z_height: 50
variable_end_print_park_in: "back"
variable_pause_print_park_in: "back"
variable_macro_travel_speed: 300
variable_macro_travel_accel: 3000

#############################################################################################################
### USER OVERRIDES & CUSTOM CONFIGURATION
### Anything custom you want to add, or RatOS configuration you want to override, do it here.
### This section is pre-populated with the most common settings you may want to change.
### See: https://os.ratrig.com/docs/configuration/includes-and-overrides
###
### It is recommended that you follow these steps to properly calibrate your printer:
### 0) Sanity check and PID Tuning: https://www.klipper3d.org/Config_checks.html
### 1) Z-offset calibration: Follow along from step 6 in the official beacon guide
###    https://docs.beacon3d.com/quickstart/#6-calibrate-beacon
### 2) Pressure Advance: https://www.klipper3d.org/Pressure_Advance.html
### 3) Skew Correction: https://www.klipper3d.org/Skew_Correction.html
### 4) Resonance Compensation: https://www.klipper3d.org/Resonance_Compensation.html
### RatOS has dedicated macro's to generate shaper graphs for deeper analysis (requires accelerometer).
### Use MEASURE_COREXY_BELT_TENSION to compare tension between belts, and use
### GENERATE_SHAPER_GRAPHS to generate the resonance graphs for analysing and manually entering input shaper
### configuration.
### You can run SHAPER_CALIBRATE to automatically calibrate your input shaper configuration, if you just want
### to get started.
### Additionally, you can use the Realtime Analysis Tool to analyze your printer's performance in real-time.
### Read more about klipper here: https://www.klipper3d.org/Overview.html
#############################################################################################################

#---------------------------------------------------- X -----------------------------------------------------
# The A motor in the CoreXY system, located at the rear left of the printer
# Connected to MOTOR 0 on Octopus V1.1
#------------------------------------------------------------------------------------------------------------
[stepper_x]
dir_pin: x_dir_pin                 # Add ! in front of pin name to reverse the direction of stepper_x
rotation_distance: 40              # 40 for 20 tooth 2GT pulleys, 32 for 16 tooth 2GT pulleys
homing_speed: 50
position_min: -60
position_max: 360
position_endstop: -60

#---------------------------------------------------- Y -----------------------------------------------------
# The B motor in the CoreXY system, located at the rear right of the printer
# Connected to MOTOR 1 on Octopus V1.1
#------------------------------------------------------------------------------------------------------------
[stepper_y]
dir_pin: y_dir_pin                 # Add ! in front of pin name to reverse the direction of stepper_y
rotation_distance: 40              # 40 for 20 tooth 2GT pulleys, 32 for 16 tooth 2GT pulleys
homing_speed: 50
position_min: -15
position_max: 330
position_endstop: -15

#---------------------------------------------------- Z -----------------------------------------------------
# The left Z motor for the kinematic bed
# Connected to MOTOR 5 on Octopus V1.1
#------------------------------------------------------------------------------------------------------------
[stepper_z]
dir_pin: !z0_dir_pin               # Remove ! in front of pin name to reverse the direction of stepper_z
rotation_distance: 4               # 4 for TR8*4 lead screws
homing_speed: 10
position_min: -5
position_max: 300

#---------------------------------------------------- Z1 ----------------------------------------------------
# The rear Z motor for the kinematic bed
# Connected to MOTOR 6 on Octopus V1.1
#------------------------------------------------------------------------------------------------------------
[stepper_z1]
dir_pin: !z1_dir_pin               # Remove ! in front of pin name to reverse the direction of stepper_z1
rotation_distance: 4               # 4 for TR8*4 lead screws

#---------------------------------------------------- Z2 ----------------------------------------------------
# The right Z motor for the kinematic bed
# Connected to MOTOR 7 on Octopus V1.1
#------------------------------------------------------------------------------------------------------------
[stepper_z2]
dir_pin: !z2_dir_pin               # Remove ! in front of pin name to reverse the direction of stepper_z2
rotation_distance: 4               # 4 for TR8*4 lead screws

#------------------------------------------------- EXTRUDER -------------------------------------------------
# The extruder motor used for pushing filament through the toolhead
# Connected to EBB42 v1.2
#------------------------------------------------------------------------------------------------------------
[extruder]
dir_pin: toolboard_t0:e_dir_pin   # Remove ! in front of pin name to reverse the direction of extruder
rotation_distance: 4.63            # Orbiter 2 default
#pressure_advance: 0.05            # Check https://www.klipper3d.org/Pressure_Advance.html for pressure advance tuning.
#control: pid
#pid_kp: 28.413
#pid_ki: 1.334
#pid_kd: 151.300


[heater_bed]
#control: pid
#pid_Kp: 22.2
#pid_Ki: 1.08
#pid_Kd: 114

[input_shaper]
shaper_freq_x: 72.8 # center frequency for the X axis filter
shaper_type_x: mzv # filter type for the X axis
shaper_freq_y: 46.2 # center frequency for the Y axis filter
shaper_type_y: mzv # filter type for the Y axis
damping_ratio_x: 0.034 # damping ratio for the X axis
damping_ratio_y: 0.038 # damping ratio for the Y axis

[exclude_object]

[printer]
max_velocity: 700
max_accel: 20000

[led lightbars]
white_pin: PA2

[fan]
#pin: !toolboard_t0:PA0
pin: !PD15
enable_pin: PA3
cycle_time: 0.00004

[temperature_sensor chamber]
sensor_type: Generic 3950
sensor_pin: PF4
min_temp: 0
max_temp: 100
gcode_id: C

# REMEMBER TO CALIBRATE YOUR BEACON!
# Follow along from step 6 in the official beacon guide https://docs.beacon3d.com/quickstart/#6-calibrate-beacon

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [beacon model default]
#*# model_coef = 1.4761956875820377,
#*# 	1.823690456029502,
#*# 	0.8302691728254966,
#*# 	0.4292464022572782,
#*# 	0.30668846135675715,
#*# 	0.24048709394314377,
#*# 	-0.1514166725835506,
#*# 	-0.2574466826364682,
#*# 	0.13827307105663214,
#*# 	0.16593417742499267
#*# model_domain = 1.8238927292621696e-07,1.9282573927700006e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 39.718382
#*# model_offset = 0.00000
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 21.523
#*# pid_ki = 1.729
#*# pid_kd = 66.992
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 61.633
#*# pid_ki = 1.966
#*# pid_kd = 483.049
#*#
#*# [bed_mesh ratos]
#*# version = 1
#*# points =
#*# 	0.064853, 0.072149, 0.087200, 0.103292, 0.115450, 0.123613, 0.128691, 0.128145, 0.128630, 0.126206, 0.127322, 0.124245, 0.118716, 0.112211, 0.107039, 0.101467, 0.082084, 0.072058, 0.077093, 0.066491
#*# 	0.046786, 0.053690, 0.071393, 0.083992, 0.096937, 0.106913, 0.113004, 0.113027, 0.111478, 0.110524, 0.110971, 0.107818, 0.105181, 0.096033, 0.089806, 0.083122, 0.063165, 0.054045, 0.057429, 0.048804
#*# 	0.028569, 0.035919, 0.055214, 0.066321, 0.077743, 0.090099, 0.095135, 0.095235, 0.095044, 0.095826, 0.096515, 0.094937, 0.091370, 0.081939, 0.077073, 0.069442, 0.048618, 0.040584, 0.042311, 0.032655
#*# 	0.015722, 0.023404, 0.038670, 0.051484, 0.063299, 0.074120, 0.079974, 0.080032, 0.081655, 0.086109, 0.085332, 0.084926, 0.079688, 0.069288, 0.063120, 0.056054, 0.036620, 0.033111, 0.030991, 0.019951
#*# 	0.004713, 0.014415, 0.028840, 0.039204, 0.050159, 0.061660, 0.066933, 0.069467, 0.071733, 0.077173, 0.075439, 0.072382, 0.068355, 0.058331, 0.053918, 0.047135, 0.028541, 0.022536, 0.020485, 0.009846
#*# 	-0.004543, 0.005755, 0.018724, 0.030697, 0.040255, 0.051579, 0.056993, 0.059323, 0.059601, 0.067599, 0.066753, 0.061452, 0.057414, 0.049856, 0.045438, 0.036652, 0.018191, 0.013073, 0.008873, -0.000778
#*# 	-0.015815, -0.003810, 0.012339, 0.021042, 0.029296, 0.040924, 0.048604, 0.049824, 0.051269, 0.057709, 0.057176, 0.048610, 0.048099, 0.041041, 0.035371, 0.028045, 0.011193, 0.003700, 0.000742, -0.011294
#*# 	-0.026520, -0.015510, -0.001047, 0.010874, 0.018832, 0.028901, 0.038474, 0.039232, 0.040313, 0.047407, 0.044986, 0.036461, 0.036301, 0.028587, 0.026064, 0.015746, -0.001377, -0.005893, -0.008912, -0.019574
#*# 	-0.035831, -0.026141, -0.010753, -0.000637, 0.008699, 0.019264, 0.025528, 0.028111, 0.029834, 0.034835, 0.032026, 0.022955, 0.024357, 0.017495, 0.012817, 0.001872, -0.013247, -0.021033, -0.021682, -0.034935
#*# 	-0.046840, -0.039149, -0.023582, -0.008382, -0.001093, 0.009099, 0.014981, 0.016224, 0.018639, 0.024299, 0.020177, 0.013671, 0.014800, 0.005554, 0.002184, -0.009555, -0.026820, -0.030958, -0.034104, -0.049047
#*# 	-0.061684, -0.052699, -0.038450, -0.021116, -0.012279, -0.002968, 0.003639, 0.003213, 0.006890, 0.012256, 0.008947, 0.003590, 0.004850, -0.004657, -0.010300, -0.020014, -0.036968, -0.044325, -0.046780, -0.061543
#*# 	-0.070039, -0.059293, -0.047013, -0.030220, -0.019451, -0.012676, -0.005729, -0.004876, -0.000186, 0.004191, 0.003182, -0.001386, -0.002178, -0.010338, -0.014597, -0.027491, -0.045767, -0.051256, -0.055122, -0.068269
#*# 	-0.084564, -0.072244, -0.053084, -0.040165, -0.030682, -0.022471, -0.015518, -0.013205, -0.005568, -0.001024, -0.003610, -0.008663, -0.008131, -0.016170, -0.023696, -0.035822, -0.054605, -0.059098, -0.061901, -0.076020
#*# 	-0.090884, -0.076539, -0.060111, -0.045448, -0.039499, -0.028661, -0.019715, -0.016923, -0.008663, -0.003979, -0.006869, -0.010884, -0.012702, -0.019534, -0.026933, -0.039604, -0.058534, -0.061498, -0.065133, -0.078487
#*# 	-0.095607, -0.081600, -0.063955, -0.052540, -0.048596, -0.034283, -0.025273, -0.019463, -0.011870, -0.008597, -0.012670, -0.015355, -0.015462, -0.022102, -0.030271, -0.043525, -0.059325, -0.067698, -0.066907, -0.076310
#*# 	-0.095970, -0.083314, -0.068213, -0.054884, -0.049209, -0.035757, -0.026388, -0.019716, -0.013462, -0.009390, -0.013168, -0.016388, -0.019437, -0.023886, -0.027792, -0.041488, -0.058642, -0.063395, -0.060303, -0.070649
#*# x_count = 20
#*# y_count = 16
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 20.0
#*# max_x = 270.0
#*# min_y = 30.0
#*# max_y = 207.702
#*#
#*# [bed_mesh Contact]
#*# version = 1
#*# points =
#*# 	0.028229, 0.042135, 0.076198, 0.103698, 0.104323, 0.095573, 0.104323, 0.088229, 0.091510, 0.096354, 0.086042, 0.077917, 0.066510, 0.059167, 0.076823
#*# 	0.019167, 0.052292, 0.080573, 0.093854, 0.106979, 0.095885, 0.087292, 0.090729, 0.097760, 0.084948, 0.075885, 0.075729, 0.055417, 0.053542, 0.050417
#*# 	0.027760, 0.046042, 0.076510, 0.082917, 0.085104, 0.085417, 0.090417, 0.082448, 0.090573, 0.079948, 0.064792, 0.045104, 0.047448, 0.040729, 0.041198
#*# 	0.047135, 0.034635, 0.058385, 0.061667, 0.069167, 0.080573, 0.074010, 0.085573, 0.086979, 0.078542, 0.057135, 0.044792, 0.032292, 0.025260, 0.010260
#*# 	0.019323, 0.041667, 0.050260, 0.077917, 0.081510, 0.085885, 0.089167, 0.079792, 0.057604, 0.053542, 0.050417, 0.048385, 0.015573, 0.001979, -0.010208
#*# 	0.028385, 0.052448, 0.059635, 0.052917, 0.065104, 0.087760, 0.071354, 0.081042, 0.055104, 0.055417, 0.053073, 0.031823, 0.012917, 0.005260, -0.017083
#*# 	0.038229, 0.033385, 0.049792, 0.064948, 0.073073, 0.065417, 0.065104, 0.061823, 0.051042, 0.046667, 0.021042, 0.004323, -0.009115, -0.021146, -0.024115
#*# 	0.009479, 0.040729, 0.054167, 0.059323, 0.061823, 0.069635, 0.059635, 0.066354, 0.029010, 0.034010, -0.002083, 0.003073, -0.024896, -0.040833, -0.053958
#*# 	0.012448, 0.028229, 0.041354, 0.061042, 0.047760, 0.052448, 0.060573, 0.042135, 0.029167, 0.005729, 0.011823, -0.015365, -0.032552, -0.053177, -0.068958
#*# 	0.025573, 0.028385, 0.037604, 0.048385, 0.046354, 0.044010, 0.037604, 0.038698, 0.026198, 0.014323, 0.000104, -0.011458, -0.055052, -0.069896, -0.090833
#*# 	0.008542, 0.026198, 0.039479, 0.049635, 0.061979, 0.034948, 0.030885, 0.024010, 0.021823, 0.000885, -0.020208, -0.036458, -0.068177, -0.092396, -0.096146
#*# 	0.025885, 0.018854, 0.027135, 0.030104, 0.032448, 0.040573, 0.029323, 0.021198, 0.014792, 0.005573, -0.024740, -0.052396, -0.080208, -0.092396, -0.115677
#*# 	0.025260, 0.039010, 0.046042, 0.048229, 0.039323, 0.034792, 0.044792, 0.021667, -0.008333, 0.003854, -0.023958, -0.049896, -0.068490, -0.098177, -0.131458
#*# 	0.024167, 0.042135, 0.054948, 0.041198, 0.044323, 0.056667, 0.043542, 0.056510, 0.028229, -0.012865, -0.025052, -0.063802, -0.074115, -0.110521, -0.124427
#*# 	0.054479, 0.051510, 0.060417, 0.059792, 0.065885, 0.042760, 0.046823, 0.021510, 0.017292, -0.016146, -0.023021, -0.053958, -0.086302, -0.111615, -0.115521
#*# x_count = 15
#*# y_count = 15
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 20.0
#*# max_x = 269.9
#*# min_y = 30.0
#*# max_y = 227.4